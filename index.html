<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Iron Lunch</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* === Your existing styles === */
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      margin: 0;
      font-family: Arial, sans-serif;
      background: #fff;
      animation: fadeIn 2s ease-in;
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    h1 {
      margin-top: 60px;
      margin-bottom: 40px;
      font-size: 48px;
      font-weight: bold;
      text-align: center;
      color: #333;
    }
    .row { display: flex; justify-content: center; margin: 20px 0; gap: 20px; flex-wrap: wrap; }
    .box {
      padding: 20px 30px; border: 1px solid #333; border-radius: 8px; text-align: center;
      text-decoration: none; color: #333; font-weight: bold; transition: background 0.3s, color 0.3s;
      min-width: 180px;
    }
    .box:hover { background: #333; color: #fff; }
    .row.bottom .box { min-width: 140px; }

    /* === Onboarding overlay styles (new) === */
    .il-overlay { position: fixed; inset: 0; display: none; align-items: center; justify-content: center;
      background: rgba(0,0,0,.5); backdrop-filter: blur(4px); z-index: 9999; }
    .il-card { width: min(920px, 92vw); background: #fff; border-radius: 24px;
      box-shadow: 0 10px 30px rgba(0,0,0,.12); overflow: hidden; border: 1px solid rgba(0,0,0,.06); }
    .il-header { display: flex; justify-content: space-between; align-items: center; padding: 14px 18px;
      border-bottom: 1px solid rgba(0,0,0,.06); }
    .il-brand { font-weight: 600; font-size: 14px; color: #64748b; }
    .il-dots { display: inline-flex; gap: 6px; }
    .il-dot { width: 22px; height: 6px; border-radius: 999px; background: #e5e7eb; }
    .il-dot.active { background: #2563eb; }
    .il-btn { appearance: none; border: 0; border-radius: 12px; padding: 8px 12px; font-weight: 600; cursor: pointer; }
    .il-btn-ghost { background: transparent; color: #334155; }
    .il-btn-primary { background: #2563eb; color: #fff; }
    .il-btn-success { background: #22c55e; color: #fff; }

    .il-layout { display: grid; grid-template-columns: 1fr; }
    @media (min-width:640px){ .il-layout{ grid-template-columns: 1fr 1fr; } }
    .il-scene { position: relative; padding: 16px; height: 340px; }
    @media (min-width:640px){ .il-scene{ height: 440px; } }
    .il-svgwrap { position: absolute; inset: 0; padding: 16px; }
    .il-copy { padding: 20px 24px; display: flex; flex-direction: column; gap: 16px; }
    .il-title { font-size: 22px; font-weight: 700; }
    .il-body { color: #334155; line-height: 1.6; }
    .il-controls { margin-top: auto; display: flex; gap: 10px; }

    /* smiley */
    .il-smile { position: absolute; width: 36px; height: 36px; border-radius: 999px; background: #22c55e; color: #fff;
      display: grid; place-items: center; font-size: 20px; transform: translate(-50%,-50%); }

    /* Hide overlay if JS disabled (page still usable) */
    noscript .il-overlay { display: none !important; }
  </style>
</head>
<body>

  <!-- Onboarding overlay (new) -->
  <div id="il-intro" class="il-overlay" role="dialog" aria-modal="true" aria-labelledby="il-title">
    <div class="il-card">
      <div class="il-header">
        <div class="il-brand">Iron Lunch</div>
        <div style="display:flex; align-items:center; gap:10px;">
          <div class="il-dots" aria-hidden="true">
            <div class="il-dot" id="il-d1"></div><div class="il-dot" id="il-d2"></div>
            <div class="il-dot" id="il-d3"></div><div class="il-dot" id="il-d4"></div>
          </div>
          <button id="il-skip" class="il-btn il-btn-ghost" aria-label="Skip intro">Skip</button>
        </div>
      </div>

      <div class="il-layout">
        <!-- Animation pane -->
        <div class="il-scene">
          <div class="il-svgwrap">
            <svg id="il-stage" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid meet" aria-hidden="true">
              <!-- U curve -->
              <path id="il-u" d="M 14,22 C 14,84 86,84 86,22" fill="none" stroke="#cbd5e1" stroke-width="8"></path>
              <!-- boost pulse -->
              <circle id="il-boost" cx="50" cy="82" r="0" fill="#E0F2FE" opacity="0"></circle>
              <!-- ball -->
              <circle id="il-ball" r="3.4" fill="#0ea5e9" cx="14" cy="22"></circle>
              <!-- tiny label 'you' -->
              <g id="il-tag" transform="translate(16,16)">
                <rect x="-10" y="-6" width="20" height="8" rx="2" fill="#0ea5e9" opacity="0.12"></rect>
                <text x="0" y="0" text-anchor="middle" alignment-baseline="middle" font-size="3.2" fill="#0369A1">you</text>
              </g>
              <text x="8" y="10" font-size="4" fill="#475569">morning → afternoon</text>
              <text x="18" y="20" font-size="4" fill="#475569">your workday</text>
            </svg>
          </div>
        </div>

        <!-- Copy + controls -->
        <div class="il-copy">
          <h3 id="il-title" class="il-title">It's difficult to maintain your energy through the workday.</h3>
          <p id="il-body" class="il-body">Without support, your day gathers speed but stalls before the finish.</p>
          <div class="il-controls">
            <button id="il-back" class="il-btn il-btn-ghost" disabled>Back</button>
            <button id="il-next" class="il-btn il-btn-primary">Continue</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Your existing page content -->
  <h1>IRON LUNCH</h1>

  <div class="row top">
    <a href="https://docs.google.com/forms/d/e/1FAIpQLSc25wTJRKK86_SyULZkZBuKlJ0YzAXwbN9F23-5Zsfa7Cr87w/viewform?usp=dialog" class="box">Onboarding</a>
    <a href="/complete.html" class="box">Complete Your Iron Lunch</a>
    <a href="https://docs.google.com/forms/YOUR_FEEDBACK_FORM_LINK_HERE" class="box">Feedback Survey</a>
  </div>

  <div class="row bottom">
    <a href="/about.html" class="box">About</a>
    <a href="/bonus.html" class="box">Did Somebody Say BONUS POINTS?</a>
  </div>

  <!-- Onboarding script (new) -->
  <script>
  (function(){
    const STORAGE_KEY = "il-onboarded-v1";
    const intro = document.getElementById("il-intro");
    const params = new URLSearchParams(location.search);
    const force = params.get("intro") === "1";
    const seen = !!localStorage.getItem(STORAGE_KEY);

    // show if first time or forced
    if (!seen || force) intro.style.display = "flex";

    const dots = [1,2,3,4].map(i=>document.getElementById("il-d"+i));
    const title = document.getElementById("il-title");
    const body = document.getElementById("il-body");
    const back = document.getElementById("il-back");
    const next = document.getElementById("il-next");
    const skip = document.getElementById("il-skip");

    const stage = document.getElementById("il-stage");
    const u = document.getElementById("il-u");
    const ball = document.getElementById("il-ball");
    const tag = document.getElementById("il-tag");
    const boost = document.getElementById("il-boost");
    const prefersReduced = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;

    let step = 1;
    let raf;

    const copy = {
      1: ["It's difficult to maintain your energy through the workday.","Without support, your day gathers speed but stalls before the finish."],
      2: ["Iron Lunch is here to help.","A quick, science-backed boost at midday powers you over the afternoon hump."],
      3: ["Three personalized routines.","Iron Lunch gives you three personalized routines to power through your afternoon, helping you be more productive and have more energy to do what you love after work."],
      4: ["A healthier, happier workday.","More energy for what matters after work—without burning out at noon."]
    };

    function setDots(n){ dots.forEach((d,i)=>d.classList.toggle("active", i < n)); }
    function moveBall(progress){
      const len = u.getTotalLength();
      const pt = u.getPointAtLength(Math.max(0, Math.min(1, progress)) * len);
      ball.setAttribute("cx", pt.x);
      ball.setAttribute("cy", pt.y);
      tag.setAttribute("transform", `translate(${pt.x + 2}, ${pt.y - 6})`);
    }
    function animateKeyframes(keys, ms) {
      cancelAnimationFrame(raf);
      const start = performance.now();
      function frame(now){
        const t = Math.min(1, (now - start) / ms);
        const e = 0.5 * (1 - Math.cos(Math.PI * t)); // easeInOut
        const segs = keys.length - 1;
        const pos = e * segs;
        const i = Math.min(segs - 1, Math.floor(pos));
        const localT = pos - i;
        const a = keys[i], c = keys[i+1];
        const p = a + (c - a) * localT;
        moveBall(p);
        if (t < 1) raf = requestAnimationFrame(frame);
      }
      raf = requestAnimationFrame(frame);
    }
    function pulseBoost(enable){
      if (!enable) { boost.setAttribute("r","0"); boost.setAttribute("opacity","0"); return; }
      let growing = true; let r = 10, op = 0.2;
      function loop(){
        r += growing ? 0.6 : -0.6;
        op += growing ? 0.015 : -0.015;
        if (r > 18) growing = false;
        if (r < 10) growing = true;
        boost.setAttribute("r", String(r));
        boost.setAttribute("opacity", String(op));
        if (step === 2) requestAnimationFrame(loop);
        else { boost.setAttribute("r","0"); boost.setAttribute("opacity","0"); }
      }
      loop();
    }
    function addSmiley(){
      if (document.getElementById("il-smile")) return;
      const host = document.querySelector(".il-scene");
      const el = document.createElement("div");
      el.id = "il-smile";
      el.className = "il-smile";
      // place near top-right U end (approx 86,22 in viewBox coords)
      el.style.left = "calc(86% + 16px)";
      el.style.top  = "calc(22% + 16px)";
      el.textContent = "☺";
      host.appendChild(el);
    }
    function runScene(n){
      step = n;
      setDots(n);
      back.disabled = (n === 1);
      next.textContent = (n < 4) ? "Continue" : "Got it";
      title.textContent = copy[n][0];
      body.textContent  = copy[n][1];

      if (n === 1) {
        pulseBoost(false);
        if (prefersReduced) { moveBall(0.30); return; }
        animateKeyframes([0, 0.55, 0.35], 2200); // fail & slide back
      }
      if (n === 2) {
        pulseBoost(true);
        if (prefersReduced) { moveBall(1); return; }
        animateKeyframes([0, 0.36, 0.38, 1], 2400); // boost, succeed
      }
      if (n === 3) { pulseBoost(false); moveBall(0.75); }
      if (n === 4) { pulseBoost(false); moveBall(1); addSmiley(); }
    }

    // controls
    back.addEventListener("click", () => runScene(Math.max(1, step - 1)));
    next.addEventListener("click", () => {
      if (step < 4) runScene(step + 1);
      else { localStorage.setItem(STORAGE_KEY, "1"); intro.style.display = "none"; }
    });
    skip.addEventListener("click", () => { localStorage.setItem(STORAGE_KEY, "1"); intro.style.display = "none"; });
    document.addEventListener("keydown", (e)=>{
      if (intro.style.display !== "flex") return;
      if (e.key === "Escape") { localStorage.setItem(STORAGE_KEY, "1"); intro.style.display = "none"; }
      if (e.key === "ArrowRight" || e.key === "Enter" || e.key === " ") { next.click(); }
      if (e.key === "ArrowLeft") { back.click(); }
    });

    // start
    runScene(1);
  })();
  </script>

  <noscript>
    <!-- If JS is off, the intro won't show; page stays usable -->
  </noscript>
</body>
</html>
